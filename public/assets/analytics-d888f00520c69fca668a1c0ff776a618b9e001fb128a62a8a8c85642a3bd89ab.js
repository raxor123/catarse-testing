window.CatarseAnalytics=window.CatarseAnalytics||function(){function m(){var t=window.location,e=t.origin||t.protocol+"//"+t.hostname;return{referrer:document.referrer||undefined,url:t.href,protocol:t.protocol.substr(0,t.protocol.length-1),hostname:t.hostname,domain:e,pathname:t.pathname||t.href.substr(e.length).replace(/[\?\#].*$/,""),userAgent:"undefined"!=typeof navigator?navigator.userAgent:undefined,hash:t.hash.replace(/^\#/,""),query:function(){if(t.search)try{return t.search.replace(/^\?/,"").split("&").reduce(function(e,t){var r=t.split("=").map(function(e){return decodeURIComponent(e.replace("+"," "))});return e[r[0]]=r[1],e},{})}catch(e){return t.search}}()}}function f(){if(window.CatarseAnalyticsURL)return window.CatarseAnalyticsURL;if(r)return r;var e=document.getElementById("api-host");return(r=e&&e.getAttribute("content"))&&(r+="/rpc/track"),r}function l(){if(a)return a;var e=document.getElementsByTagName("body"),t=e&&e[0]&&e[0].getAttribute("data-user");if(t)try{return a=JSON.parse(t)}catch(r){console.error("[CatarseAnalytics._getUser] error parsing data "+JSON.stringify(t),r)}}function p(){if(o)return o;var e=document.getElementById("project-show-root")||document.getElementById("project-header"),t=e&&(e.getAttribute("data-parameters")||e.getAttribute("data-stats"));if(t)try{return o=JSON.parse(t)}catch(r){console.error("[CatarseAnalytics._getProject] error parsing data "+JSON.stringify(t),r)}}function n(e,t,r){if(e)try{var n=e.project||p(),a=e.user||l(),o=window.ga,i="function"==typeof o&&o.getAll&&o.getAll()&&o.getAll()[0]||null;r=r||"function"!=typeof o;var c=e.extraData&&"object"==typeof e.extraData?JSON.parse(JSON.stringify(e.extraData)):{};c.ctrse_sid=h,c.origin=y,c.category=e.cat,c.action=e.act,c.label=e.lbl,c.value=e.val,c.request=m(),a&&a.user_id&&(c.user={id:a.user_id,contributions:a.contributions,published_projects:a.published_projects}),n&&(n.id||n.project_id)&&(c.project={id:n.id||n.project_id,user_id:n.user_id||n.project_user_id,category_id:n.category_id,state:n.address&&n.address.state_acronym,city:n.address&&n.address.city}),i&&(c.ga={clientId:i.get("clientId")});try{var s=f();if(s){var u={event:c};g({url:s,body:JSON.stringify(u),headers:{"Content-Type":"application/json; charset=utf-8"}},function(e,t,r){200!==e&&console.error(e,t,r)})}}catch(d){console.error("[CatarseAnalytics.event] error:",d)}r||void 0===o||o("send","event",e.cat,e.act,e.lbl,e.val,{nonInteraction:!1!==e.nonInteraction,transport:"beacon"})}catch(d){console.error("[CatarseAnalytics.event] error:",d)}t&&t()}function e(e){i&&clearTimeout(i),i=setTimeout(function(){n({cat:"navigation",act:"pageview",lbl:location.pathname},null,!0),e||"undefined"==typeof ga||(ga("set","page",location.pathname),ga("send","pageview",location.pathname))})}function t(e,t,r,n,a,o){try{"function"==typeof ga&&(ga("ecommerce:addTransaction",{id:e,revenue:a,tax:o,current:"BRL"}),ga("ecommerce:addItem",{id:e,name:t,sku:r,category:n,price:a,quantity:"1"}),ga("ecommerce:send"))}catch(i){console.error("[CatarseAnalytics.checkout]",i)}}var r,a,o,i,c={set:function(e,t,r,n,a,o){var i=new Date,c="",s=typeof t,u="",d="";if(n=n||"/",r&&(i.setTime(i.getTime()+24*r*60*60*1e3),c="; expires="+i.toUTCString()),"object"===s&&"undefined"!==s){if(!("JSON"in window))throw"Bummer, your browser doesn't support JSON parsing.";u=encodeURIComponent(JSON.stringify({v:t}))}else u=encodeURIComponent(t);a&&(d="; secure"),o=o?"; domain="+encodeURIComponent(o):"",document.cookie=e+"="+u+c+"; path="+n+d+o},get:function(e){for(var t=e+"=",r=document.cookie.split(";"),n="",a={},o=0;o<r.length;o++){for(var i=r[o];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t)){if("{"==(n=decodeURIComponent(i.substring(t.length,i.length))).substring(0,1))try{if("v"in(a=JSON.parse(n)))return a.v}catch(c){return n}return"undefined"==n?undefined:n}}return null},remove:function(e){this.set(e,"",-1)},increment:function(e,t){var r=this.get(e)||0;this.set(e,parseInt(r,10)+1,t)},decrement:function(e,t){var r=this.get(e)||0;this.set(e,parseInt(r,10)-1,t)}},g=function(){function s(){if(window.XMLHttpRequest)return new window.XMLHttpRequest;try{return new window.ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){}throw new Error("no xmlhttp request able to be created")}function u(e,t,r){e[t]=e[t]||r}return function(e,t){"string"==typeof e&&(e={url:e});var r=e.headers||{},n=e.body,a=e.method||(n?"POST":"GET"),o=e.withCredentials||!1,i=s();for(var c in i.withCredentials=o,i.onreadystatechange=function(){4==i.readyState&&t(i.status,i.responseText,i)},n&&(u(r,"X-Requested-With","XMLHttpRequest"),u(r,"Content-Type","application/json; charset=utf-8")),i.open(a,e.url,!0),r)i.setRequestHeader(c,r[c]);i.send(n)}}(),h=function(e){var t=e.get("ctrse_sid");t||(t=function(){for(var r=[],e=0;e<=15;e++)r[e]=e.toString(16);return function(){for(var e="",t=1;t<=36;t++)e+=9===t||14===t||19===t||24===t?"-":15===t?4:20===t?r[4*Math.random()|8]:r[15*Math.random()|0];return e}}()());return e.set("ctrse_sid",t,180,"/",!1,".catarse.me"),t}(c),s={};try{var y=function(e,t){try{var r=JSON.parse(t.get("ctrse_origin")||null)||{createdAt:new Date}}catch(i){r={createdAt:new Date}}if(e.referrer&&/^https?:\/\/([^\\/]+\.)?catarse\.me/.test(e.referrer))r.ref=e.query&&e.query.ref||r.ref;else if(e.referrer||!r._time||6e5<(new Date).getTime()-r._time){var n=e.referrer&&e.referrer.match(/https?:\/\/([^\/\?#]+)/),a=n&&n[1]||undefined,o=e.query;o&&["utm_campaign","utm_source","utm_medium","utm_content","utm_term"].some(function(e){return!!o[e]})?(r.domain=a,r.campaign=o.utm_campaign,r.source=o.utm_source,r.medium=o.utm_medium,r.content=o.utm_content,r.term=o.utm_term):a&&!["domain","utm_campaign","utm_source","utm_medium","utm_content","utm_term"].some(function(e){return!!r[e]})&&(r.domain=a),!r.campaign&&o&&o.ref&&(r.campaign=o.ref)}return r._time=(new Date).getTime(),t.set("ctrse_origin",JSON.stringify(r),180,"/",!1,".catarse.me"),r}(m(),c)}catch(u){console.error("[CatarseAnalytics] error",u)}return e(!0),{origin:y,event:n,pageView:e,oneTimeEvent:function(e,t){if(!e)return t;try{if(!e.cat&&!e.act)throw new Error("Should inform cat or act");var r=e.cat&&e.act?e.cat+"_"+e.act:e.cat||e.act;s[r]||(s[r]=!0,n(e,t))}catch(u){console.error("[CatarseAnalytics.oneTimeEvent] error:",u)}},checkout:t}}();